pipeline {
  agent any;

  stages {
    stage("GIT") {

     steps {
       dir('gestion-station-ski') {
        sh 'git checkout achraf'
        sh 'git pull origin achraf'
      }}
    }

    stage("MAVEN BUILD") {
      steps {
       dir('gestion-station-ski') {
        sh 'mvn clean install -Dmaven.test.skip=true'
      }}
    }
    stage("SONARQUBE") {
      steps {
        dir('gestion-station-ski') {
       sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=181JMT2239"
      }}
    }
    stage("Junit/MOCKITO") {
      steps {
        dir('gestion-station-ski') {
        sh "mvn test"
      }}
    }

    stage('MVN NEXUS')
                      {
                      steps {
                            dir('gestion-station-ski') {

                      sh 'mvn  deploy -DskipTests  '
                      } }
                      }

                      stage("build docker image") {
                                                  steps {
                                                   dir('gestion-station-ski'){
                                                    sh 'docker build -t achrafbouslama123/achraf-bouslama-sae4-gestion-station-ski:latest .'
                                                  }
                                                }
                                                }

           stage('docker push'){
                              steps{
                                    dir('gestion-station-ski') {

                                      sh 'docker login -u "achrafbouslama123" -p "181JMT2239" '
                                      sh 'docker push achrafbouslama123/achraf-bouslama-sae4-gestion-station-ski:latest'
                                  }
                              }
                          }
    tage("docker-compose") {
                                                      steps {
                                                       dir('gestion-station-ski'){
                                                        sh 'docker compose up -d'
                                                      }
                                                    }
                                                    }
                      }


}
