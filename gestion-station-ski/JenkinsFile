pipeline {
  agent any;
stages {
    stage("GIT") {
      steps {
        sh 'git checkout khaznaji'
        sh 'git pull origin khaznaji'
      }
    }
    stage("MAVEN BUILD") {
      steps {
       dir('gestion-station-ski') {
        sh 'mvn clean install -Dmaven.test.skip=true'
      }
    }
    }
    stage("SONARQUBE") {
      steps {
      dir('gestion-station-ski') {
       sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=azerty123"
      }}
    }
    stage("MOCKITO") {
      steps {
      dir('gestion-station-ski') {
        sh "mvn test -Dtest=tn.esprit.spring.services.SubscriptionServicesImplMock"
      }}
    }

stage("BUILD DOCKER IMAGE") {
        steps {
              dir('gestion-station-ski') {

          sh 'docker build -t khaznaji/oumaymalynakhaznaji-5sae4-g1-gestionstationski:latest .'
        }}
      }
      stage('docker push'){
                   steps{
                         dir('gestion-station-ski') {

                       script{
                           sh 'docker login -u "khaznaji" -p "191JFT2725" docker.io'
                           sh 'docker push khaznaji/oumaymalynakhaznaji-5sae4-g1-gestionstationski:latest'
                       }
                   }
               }}

          stage('docker compose') {
              steps{
                    dir('gestion-station-ski') {

                  sh 'docker compose up -d'
              }}
          }
          stage('MVN NEXUS')
                  {
                  steps {
                        dir('gestion-station-ski') {

                  sh 'mvn  deploy -DskipTests  '
                  }}
                  }

/*stage("Angular BUILD") {
  steps {
    dir('C:/Users/DELL/Desktop/devops/test1') {
      sh 'ng build --prod' // Make sure to adapt this command to your Angular project
    }
  }
}*/
   post {
        success {
            // Étape à exécuter en cas de succès du pipeline
            emailext(
                subject: "Build Successful",
                body: "Votre build Jenkins a réussi. Félicitations!",
                to: "lyna.khaznaji@gmail.com",
            )
        }
        failure {
            // Étape à exécuter en cas d'échec du pipeline
            emailext(
                subject: "Build Failed",
                body: "Votre build Jenkins a échoué. Veuillez vérifier les détails du build.",
                to: "lyna.khaznaji@gmail.com",
            )
        }


}}