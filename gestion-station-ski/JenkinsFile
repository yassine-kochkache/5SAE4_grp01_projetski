pipeline {
  agent any;
  environment {
              registryCredential = 'test'
              dockerImageBack = "yassinekoch/yassine-kochkache-sae4-gestion-station-ski:latest"
          }


//
  stages {
   stage("GIT") {
     steps {
       sh 'git checkout yassin'
       sh 'git pull origin yassin'
      }
    }
//     //
   stage("MAVEN BUILD") {
      steps {
      dir('gestion-station-ski'){
       sh 'mvn clean install -Dmaven.test.skip=true'
      }}
   }
 /*  stage("SONARQUBE") {
         steps {
            	dir('gestion-station-ski'){
         sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=azerty123"
        }}
      }*/
      /*  stage("MOCKITO") {
                steps {
                    	dir('gestion-station-ski'){
                sh "mvn test -Dtest=tn.esprit.spring.services.SkierServiceImpMock"
                }}
              }*/
//     stage("MOCKITO") {
//       steps {
//       dir('gestion-station-ski'){
//         sh "mvn test -Dtest=tn.esprit.spring.services.SkierServiceImpMock"
//       }}
//     }
/*stage('MVN NEXUS')
        {
        steps {
        dir('gestion-station-ski'){
        sh 'mvn  deploy -DskipTests  '
        }}
        }*/
        //
        /*stage('Build and Push back Image') {
                     steps {
                         dir('gestion-station-ski'){
                         script {


                //             // Build the backend Docker image
                             def backendImage = docker.build('yassine987/projet-devops', '-f /var/lib/jenkins/workspace/projettski_sae4_grp1/gestion-station-ski/Dockerfile .')

                //             // Authentification Docker Hub avec des informations d'identification secr√®tes
                             withCredentials([string(credentialsId: 'docker', variable: 'pwd')]) {
                                 sh "docker login -u yassine987 -p azerty123 "
                                 // Poussez l'image Docker
                                 backendImage.push()
                             }
                         }
                         }
                     }
                 }*/
stage("build docker image") {
                            steps {
                             dir('gestion-station-ski'){
                              sh 'docker build -t yassine-kochkache-sae4-gestion-station-ski:latest .'
                            }
                          }}
                       /*   stage('Build and Push Docker Image') {
                                     steps {
                                         script {
                                             withCredentials([usernamePassword(credentialsId: 'dockerhub-yassinekochkache', passwordVariable: 'DOCKER_PASSWORD', usernameVariable: 'DOCKER_USERNAME')]) {
                                                 DOCKER_USERNAME = 'yassinekochkache'
                                                 DOCKER_PASSWORD = 'azerty123'

                                                 sh "docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD docker.io"
                                                 sh "docker push yassinekochkache/yassine-kochkache-grp01-gestion-station-ski:latest"
                                             }
                                         }
                                     }
                                 }
*/

/*stage('Deploy Docker Image') {
        steps {
         dir('gestion-station-ski') {
         withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'dockerhubpwd')]) {
            sh '''
              docker login -u yassinekochkache -p $DOCKER_PASSWORD
              docker push yassinekochkache/yassine-kochkache-grp01-gestion-station-ski:latest
            '''
          }
        }}
      }*/
      //
      //
      //testtt
    /*  stage('Uploading Backend Image') {
                  steps{
                     dir('gestion-station-ski') {
                          script {
                              docker.withRegistry( '', registryCredential ) {
                               sh 'docker push ${dockerImageBack} '
                              }
                          }
                      }
                  }
              }*/
stage('docker push'){
                   steps{
                         dir('gestion-station-ski') {



                           sh 'docker login -u yassine987 -p azerty123 '
                           sh 'docker tag yassine-kochkache-sae4-gestion-station-ski:latest yassine987/yassine-kochkache-sae4-gestion-station-ski:latest'
                           sh 'docker push yassine987/yassine-kochkache-sae4-gestion-station-ski:latest'

                   }
               }}
/*stage('docker compose') {
              steps{
                    dir('gestion-station-ski') {

                  sh 'docker compose up -d'
              }}
          }*/

// stage("Docker Login") {
//             steps {
//             dir('gestion-station-ski'){
//                 withCredentials([usernamePassword(credentialsId: 'DOCKER', usernameVariable: 'DOCKER_USERNAME', passwordVariable: 'DOCKER_PASSWORD')]) {
//                     sh "docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD"
//                 }
//             }}
//         }
//          stage("Push Image to Docker Hub") {
//             steps {
//             dir('gestion-station-ski'){
//                 sh 'docker push yassinekoch/yassine-kochkache-sae4-gestion-station-ski:latest'
//             }}
//         }


}


}