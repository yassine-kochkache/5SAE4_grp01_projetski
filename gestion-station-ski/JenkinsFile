pipeline {
  agent any;



  stages {
    stage("GIT") {
      steps {
        sh 'git checkout yassin'
        sh 'git pull origin yassin'
      }
    }
    //
    stage("MAVEN BUILD") {
      steps {
      dir('gestion-station-ski'){
        sh 'mvn clean install -Dmaven.test.skip=true'
      }}
    }
    stage("SONARQUBE") {
         steps {
             	dir('gestion-station-ski'){
          sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=azerty123"
         }}
       }
        stage("MOCKITO") {
                steps {
                    	dir('gestion-station-ski'){
                 sh "mvn test -Dtest=tn.esprit.spring.services.SkierServiceImpMock"
                }}
              }
//     stage("MOCKITO") {
//       steps {
//       dir('gestion-station-ski'){
//         sh "mvn test -Dtest=tn.esprit.spring.services.SkierServiceImpMock"
//       }}
//     }
stage('MVN NEXUS')
        {
        steps {
        dir('gestion-station-ski'){
        sh 'mvn  deploy -DskipTests  '
        }}
        }
 stage("build docker image") {
                            steps {
                             dir('gestion-station-ski'){
                              sh 'docker build -t yassinekochkache/yassine-kochkache-grp01-gestion-station-ski:latest .'
                            }
                          }}

stage('docker push'){
                   steps{
                         dir('gestion-station-ski') {

                           sh 'docker login -u yassinekochkache -p azerty123'
                           sh 'docker push yassinekochkache/yassine-kochkache-grp01-gestion-station-ski:latest'
                       }
                   }
               }
stage('docker compose') {
              steps{
                    dir('gestion-station-ski') {

                  sh 'docker compose up -d'
              }}
          }




}


}